Man-in-the-middle function was originally from https://github.com/olmps/web-sniffer